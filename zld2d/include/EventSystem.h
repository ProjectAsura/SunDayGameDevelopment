//-----------------------------------------------------------------------------
// File : EventSystem.h
// Desc : System For Game Event.
// Copyright(c) Project Asura. All right reserved.
//-----------------------------------------------------------------------------
#pragma once

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <MessageMgr.h>
#include <TextWriter.h>
#include <SpriteSystem.h>


///////////////////////////////////////////////////////////////////////////////
// EventData structure
///////////////////////////////////////////////////////////////////////////////
struct EventData
{
    uint32_t        ScenarioId;     //!< シナリオID.
    uint32_t        EventId;        //!< イベントID.
    wchar_t         Text[141];      //!< Max28文字 × 5行.
};

///////////////////////////////////////////////////////////////////////////////
// BrunchData structure
//////////////////////////////////////////////////////////////////////////////
struct BrunchData
{
    uint32_t        ScenarioId;     //!< シナリオID.
    uint32_t        EventId;        //!< イベントID.
    wchar_t         Text[29];       //!< Max28文字 × 5行.
    wchar_t         Option[2][29];  //!< 選択肢.
};

///////////////////////////////////////////////////////////////////////////////
// EventSystem class
///////////////////////////////////////////////////////////////////////////////
class EventSystem : public IMessageListener
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    EventSystem();

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    ~EventSystem();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(IDWriteFactory* pFactory, ID2D1DeviceContext* pContext);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();

    //-------------------------------------------------------------------------
    //! @brief      メッセージウィンドウ枠を表示します.
    //-------------------------------------------------------------------------
    void DrawWindow(SpriteSystem& sprite, bool upper = false);

    //-------------------------------------------------------------------------
    //! @brief      会話メッセージを表示します.
    //-------------------------------------------------------------------------
    void DrawMsg(ID2D1DeviceContext* context, bool upper = false);

    //-------------------------------------------------------------------------
    //! @brief      メッセージ受信時の処理です.
    //-------------------------------------------------------------------------
    void OnMessage(const Message& msg) override;

    //-------------------------------------------------------------------------
    //! @brief      シナリオIDを取得します.
    //-------------------------------------------------------------------------
    uint32_t GetScenarioId() const;

    //-------------------------------------------------------------------------
    //! @brief      イベントIDを取得します.
    //-------------------------------------------------------------------------
    uint32_t GetEventId() const;

    //-------------------------------------------------------------------------
    //! @brief      イベント中かどうか?
    //-------------------------------------------------------------------------
    bool IsEvent() const;

private:
    //=========================================================================
    // private variables.
    //=========================================================================
    bool                m_IsDraw        = false;
    wchar_t             m_Text[141]     = {};
    wchar_t             m_Option[2][28] = {};
    uint32_t            m_ScenarioId    = 0;
    uint32_t            m_EventId       = 0;
    uint8_t             m_Type          = 0;
    uint8_t             m_CurrentChoice = 0;
    ID2D1DeviceContext* m_pContext      = nullptr;
    TextWriter          m_Writer;

    //=========================================================================
    // private methods.
    //=========================================================================

    ///------------------------------------------------------------------------
    //! @brief      選択枝無しの会話メッセージを表示します.
    //-------------------------------------------------------------------------
    void DrawEventMsg(const wchar_t* msg, bool upper);

    //-------------------------------------------------------------------------
    //! @brief      2択の会話メッセージを表示します.
    //-------------------------------------------------------------------------
    void DrawChoices2(const wchar_t* msg, const wchar_t* choise0, const wchar_t* choise1, bool upper);
};
